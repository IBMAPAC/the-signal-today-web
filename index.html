<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Signal Today">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#161616">
    <meta name="description" content="AI-powered intelligence briefing for enterprise technology leaders">
    <meta name="format-detection" content="telephone=no">
    <title>The Signal Today</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¡</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¡</text></svg>" rel="noopener noreferrer">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ğŸ“¡ The Signal Today</h1>
                <div class="header-actions">
                    <span id="reading-time" class="reading-badge">0/15 min</span>
                    <button id="export-btn" class="btn btn-secondary btn-sm" title="Export brief as Markdown">ğŸ“¤ Export</button>
                    <button id="refresh-btn" class="btn btn-primary" title="Refresh (R)">
                        <span class="refresh-icon">â†»</span> Refresh
                    </button>
                    <button id="settings-btn" class="btn btn-secondary" title="Settings">âš™ï¸</button>
                    <button class="btn btn-secondary btn-sm" onclick="app.showKeyboardHelp()" title="Keyboard shortcuts">âŒ¨ï¸</button>
                </div>
            </div>
            <div class="header-meta">
                <span id="current-date"></span>
                <span id="last-updated"></span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Loading State -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p id="loading-status">Fetching articles...</p>
            </div>

            <!-- Error State -->
            <div id="error" class="error-state hidden">
                <p id="error-message"></p>
                <button class="btn btn-primary" onclick="app.refresh()">Try Again</button>
            </div>

            <!-- Digest Content -->
            <div id="digest-content" class="digest-content hidden">
                
                <!-- Digest Tabs -->
                <div class="digest-tabs">
                    <button class="digest-tab active" data-tab="daily" onclick="switchDigestTab('daily')">
                        ğŸ“° Daily Brief
                        <span id="daily-count-badge" class="tab-badge">0</span>
                    </button>
                    <button class="digest-tab" data-tab="weekly" onclick="switchDigestTab('weekly')">
                        ğŸ“š Weekly Deep Reads
                        <span id="weekly-count-badge" class="tab-badge">0</span>
                    </button>
                </div>

                <!-- Daily Digest Tab -->
                <div id="daily-tab" class="digest-tab-content">
                    
                    <!-- Cross-Source Signals (formerly Trending Topics) -->
                    <section id="signals-section" class="card signals-card hidden">
                        <div class="card-header" onclick="toggleSection('signals')">
                            <h2>ğŸ”¥ Cross-Source Signals</h2>
                            <span id="signals-count" class="badge">0</span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div id="signals-content" class="card-body">
                            <p class="card-description">Topics covered by multiple independent sources - higher signal, lower noise</p>
                            <div id="signals-list"></div>
                        </div>
                    </section>

                    <!-- Industry Intelligence (improved) -->
                    <section id="industry-section" class="card industry-card hidden">
                        <div class="card-header" onclick="toggleSection('industry')">
                            <h2>ğŸ¢ Industry Intelligence</h2>
                            <span id="industry-count" class="badge badge-green">0</span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div id="industry-content" class="card-body">
                            <p class="card-description">Key themes emerging in your priority industries</p>
                            <div id="industry-list"></div>
                        </div>
                    </section>

                    <!-- Client Watch (improved) -->
                    <section id="clients-section" class="card clients-card hidden">
                        <div class="card-header" onclick="toggleSection('clients')">
                            <h2>ğŸ‘ï¸ Client Watch</h2>
                            <span id="clients-count" class="badge badge-purple">0</span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div id="clients-content" class="card-body">
                            <p class="card-description">Recent coverage of your watchlist accounts - useful for meeting prep and competitive intel</p>
                            <div id="clients-list"></div>
                        </div>
                    </section>

                    <!-- Action Brief -->
                    <section id="summary-section" class="card summary-card">
                        <div class="card-header">
                            <h2>âš¡ Action Brief</h2>
                        </div>
                        <div id="summary-content" class="card-body">
                            <p id="executive-summary">Pull to refresh to generate your daily digest.</p>
                        </div>
                    </section>

                    <!-- Digest Sections -->
                    <div id="digest-sections"></div>

                    <!-- Conversation Starters -->
                    <section id="starters-section" class="card starters-card hidden">
                        <div class="card-header">
                            <h2>ğŸ’¬ Conversation Openers</h2>
                        </div>
                        <div id="starters-content" class="card-body">
                            <div id="starters-list"></div>
                        </div>
                    </section>

                    <!-- All Daily Articles -->
                    <section id="articles-section" class="card">
                        <div class="card-header" onclick="toggleSection('articles')">
                            <h2>ğŸ“° All Daily Articles</h2>
                            <span id="articles-count" class="badge">0</span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div id="articles-content" class="card-body">
                            <div id="articles-list"></div>
                        </div>
                    </section>
                </div>

                <!-- Weekly Digest Tab -->
                <div id="weekly-tab" class="digest-tab-content hidden">
                    
                    <!-- Weekly Overview -->
                    <section class="card weekly-overview-card">
                        <div class="card-header">
                            <h2>ğŸ“š This Week's Deep Reads</h2>
                        </div>
                        <div class="card-body">
                            <p id="weekly-summary" class="weekly-summary">Strategic content and analyst insights worth your extended attention. Max 2 articles per source for diversity.</p>
                            <div class="weekly-stats">
                                <div class="weekly-stat">
                                    <span class="weekly-stat-value" id="weekly-article-count">0</span>
                                    <span class="weekly-stat-label">Articles</span>
                                </div>
                                <div class="weekly-stat">
                                    <span class="weekly-stat-value" id="weekly-reading-time">0</span>
                                    <span class="weekly-stat-label">Minutes</span>
                                </div>
                                <div class="weekly-stat">
                                    <span class="weekly-stat-value" id="weekly-source-count">0</span>
                                    <span class="weekly-stat-label">Sources</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Weekly Articles by Category -->
                    <div id="weekly-categories"></div>

                    <!-- All Weekly Articles -->
                    <section id="weekly-articles-section" class="card">
                        <div class="card-header" onclick="toggleSection('weekly-articles')">
                            <h2>ğŸ“– All Weekly Articles</h2>
                            <span id="weekly-articles-count" class="badge">0</span>
                            <span class="chevron">â–¼</span>
                        </div>
                        <div id="weekly-articles-content" class="card-body">
                            <div id="weekly-articles-list"></div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state">
                <div class="empty-icon">ğŸ“¡</div>
                <h2>Welcome to The Signal Today</h2>
                <p>Your AI-powered intelligence briefing for enterprise technology.</p>
                <button class="btn btn-primary btn-large" onclick="app.refresh()">
                    Generate Your First Digest
                </button>
                <p class="empty-hint">Configure your Claude API key in Settings for AI summaries.</p>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-backdrop" onclick="closeSettings()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>âš™ï¸ Settings</h2>
                    <button class="modal-close" onclick="closeSettings()">Ã—</button>
                </div>
                <div class="modal-body">
                    <!-- API Key -->
                    <section class="settings-section">
                        <h3>ğŸ¤– Claude AI</h3>
                        <div class="form-group">
                            <label for="api-key">API Key</label>
                            <input type="password" id="api-key" placeholder="sk-ant-...">
                            <p class="form-hint">âš ï¸ Your API key is stored unencrypted in browser localStorage. Do not use on shared devices.</p>
                            <p class="form-hint">Get your API key from <a href="https://console.anthropic.com/" target="_blank" rel="noopener noreferrer">console.anthropic.com</a></p>
                        </div>
                        <div class="form-group">
                            <label for="week-context">This Week's Context</label>
                            <textarea id="week-context" rows="3" placeholder="e.g. Meeting DBS CTO on Tuesday re: watsonx POC. Telstra deal review Thursday. OCBC RFP deadline Friday."></textarea>
                            <p class="form-hint">Claude will prioritize articles relevant to your current meetings and deals.</p>
                        </div>
                    </section>

                    <!-- Time Budget -->
                    <section class="settings-section">
                        <h3>â±ï¸ Time Budget</h3>
                        <div class="form-group">
                            <label for="daily-minutes">Daily Reading Minutes</label>
                            <input type="number" id="daily-minutes" min="5" max="60" value="15">
                        </div>
                        <div class="form-group">
                            <label for="weekly-articles">Weekly Article Count</label>
                            <input type="number" id="weekly-articles" min="3" max="20" value="5">
                        </div>
                        <div class="form-group">
                            <label for="auto-refresh-time">Auto-Refresh Time (24h format)</label>
                            <input type="time" id="auto-refresh-time" placeholder="06:30">
                            <p class="form-hint">Leave blank to disable. Browser must be open at this time.</p>
                        </div>
                    </section>

                    <!-- Industry Priorities -->
                    <section class="settings-section">
                        <h3>ğŸ¢ Industry Priorities</h3>
                        <p class="form-hint">Select your priority industries (Tier 1 = +30%, Tier 2 = +20%, Tier 3 = +10%)</p>
                        <div id="industry-settings"></div>
                    </section>

                    <!-- Client Watchlist -->
                    <section class="settings-section">
                        <h3>ğŸ‘¤ Client Watchlist</h3>
                        <p class="form-hint">Companies to monitor. Tier 1 (Strategic) = +35% boost, Tier 2 (Growth) = +25%, Tier 3 (Prospect) = +15%. Tiers are set automatically from defaults or can be edited in sources.js.</p>
                        <div id="client-settings">
                            <textarea id="clients-input" rows="4" placeholder="DBS, Singtel, Telstra, OCBC, UOB..."></textarea>
                        </div>
                    </section>

                    <!-- Instapaper Integration -->
                    <section class="settings-section">
                        <h3>ğŸ“¥ Instapaper</h3>
                        <p class="form-hint">Save articles to Instapaper. Articles open the Instapaper save page in a new tab.</p>
                    </section>

                    <!-- Source Management -->
                    <section class="settings-section">
                        <h3>ğŸ“° News Sources</h3>
                        <div class="sources-header">
                            <span id="sources-count">Loading sources...</span>
                            <div class="sources-actions">
                                <button class="btn btn-secondary btn-sm" onclick="addNewSource()">+ Add Source</button>
                                <button class="btn btn-secondary btn-sm" onclick="resetSources()">Reset Defaults</button>
                            </div>
                        </div>
                        <div class="sources-filter">
                            <select id="sources-category-filter" onchange="filterSources()">
                                <option value="all">All Categories</option>
                                <option value="AI & Agentic">ğŸ¤– AI & Agentic</option>
                                <option value="Sovereignty & Regulation">ğŸ›¡ï¸ Sovereignty & Regulation</option>
                                <option value="APAC Enterprise">ğŸŒ APAC Enterprise</option>
                                <option value="China & Geopolitics">ğŸ‡¨ğŸ‡³ China & Geopolitics</option>
                                <option value="Competitive Landscape">âš”ï¸ Competitive Landscape</option>
                                <option value="Architecture & Platform">ğŸ—ï¸ Architecture & Platform</option>
                                <option value="Strategic Perspectives">ğŸ’­ Strategic Perspectives</option>
                                <option value="IBM & Partners">ğŸ”µ IBM & Partners</option>
                            </select>
                        </div>
                        <div id="sources-list" class="sources-list"></div>
                    </section>

                    <!-- Data Management -->
                    <section class="settings-section">
                        <h3>ğŸ—‘ï¸ Data Management</h3>
                        <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                        <p class="form-hint">This will reset all settings and cached articles.</p>
                    </section>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Article Modal -->
        <div id="article-modal" class="modal hidden">
            <div class="modal-backdrop" onclick="closeArticle()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 id="article-title">Article Title</h2>
                    <button class="modal-close" onclick="closeArticle()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="article-meta">
                        <span id="article-source" class="article-source"></span>
                        <span id="article-date" class="article-date"></span>
                        <span id="article-score" class="article-score"></span>
                    </div>
                    <div id="article-summary" class="article-summary"></div>
                    <div class="article-actions">
                        <a id="article-link" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Read Full Article â†’</a>
                        <button id="deep-read-btn" class="btn btn-secondary hidden" onclick="app.deepReadArticle(document.getElementById('article-modal').dataset.articleId)">ğŸ¤– Deep Read</button>
                        <button class="btn btn-instapaper" onclick="saveToInstapaper()">ğŸ“¥ Save to Instapaper</button>
                        <button class="btn btn-secondary" onclick="copyArticleLink()">ğŸ“‹ Copy Link</button>
                    </div>
                    <div id="deep-read-content" class="deep-read-content hidden"></div>
                </div>
            </div>
        </div>

        <!-- Meeting Brief Modal -->
        <div id="meeting-brief-modal" class="modal hidden">
            <div class="modal-backdrop" onclick="closeMeetingBrief()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>ğŸ“‹ Meeting Brief: <span id="meeting-brief-client"></span></h2>
                    <button class="modal-close" onclick="closeMeetingBrief()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div id="meeting-brief-body">
                        <div class="meeting-brief-loading">Generating brief...</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeMeetingBrief()">Close</button>
                </div>
            </div>
        </div>

        <!-- Source Editor Modal -->
        <div id="source-modal" class="modal hidden">
            <div class="modal-backdrop" onclick="closeSourceEditor()"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="source-modal-title">Add Source</h2>
                    <button class="modal-close" onclick="closeSourceEditor()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="source-name">Source Name</label>
                        <input type="text" id="source-name" placeholder="e.g., TechCrunch">
                    </div>
                    <div class="form-group">
                        <label for="source-url">RSS Feed URL</label>
                        <input type="text" id="source-url" placeholder="https://example.com/feed.xml">
                    </div>
                    <div class="form-group">
                        <label for="source-category">Category</label>
                        <select id="source-category">
                            <option value="AI & Agentic">ğŸ¤– AI & Agentic</option>
                            <option value="Sovereignty & Regulation">ğŸ›¡ï¸ Sovereignty & Regulation</option>
                            <option value="APAC Enterprise">ğŸŒ APAC Enterprise</option>
                            <option value="China & Geopolitics">ğŸ‡¨ğŸ‡³ China & Geopolitics</option>
                            <option value="Competitive Landscape">âš”ï¸ Competitive Landscape</option>
                            <option value="Architecture & Platform">ğŸ—ï¸ Architecture & Platform</option>
                            <option value="Strategic Perspectives">ğŸ’­ Strategic Perspectives</option>
                            <option value="IBM & Partners">ğŸ”µ IBM & Partners</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <div class="priority-selector">
                            <button type="button" class="priority-btn priority-1" data-priority="1" onclick="selectPriority(1)">ğŸ”´ P1 - Must Read</button>
                            <button type="button" class="priority-btn priority-2 active" data-priority="2" onclick="selectPriority(2)">ğŸŸ  P2 - Important</button>
                            <button type="button" class="priority-btn priority-3" data-priority="3" onclick="selectPriority(3)">âšª P3 - Nice to Have</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="source-credibility">Credibility Score: <span id="credibility-value">80%</span></label>
                        <input type="range" id="source-credibility" min="50" max="100" value="80" oninput="updateCredibilityDisplay()">
                    </div>
                    <div class="form-group">
                        <label>Include In</label>
                        <div class="digest-type-selector">
                            <button type="button" class="digest-btn active" data-type="daily" onclick="selectDigestType('daily')">Daily</button>
                            <button type="button" class="digest-btn" data-type="weekly" onclick="selectDigestType('weekly')">Weekly</button>
                            <button type="button" class="digest-btn" data-type="both" onclick="selectDigestType('both')">Both</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="delete-source-btn" onclick="deleteCurrentSource()" style="margin-right: auto; display: none;">Delete</button>
                    <button class="btn btn-secondary" onclick="closeSourceEditor()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveSource()">Save Source</button>
                </div>
            </div>
        </div>
    </div>

    <script src="sources.js"></script>
    <script src="app.js"></script>
</body>
</html>
